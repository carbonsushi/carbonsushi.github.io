[{"content":"主要OSの中でAndroidだけがmDNSを名前解決できないらしい。\nhttps://qiita.com/maccadoo/items/48ace84f8aca030a12f1\nChromium・AOSPにissueが提出されているがまったくもって動きがない。\nhttps://bugs.chromium.org/p/chromium/issues/detail?id=405925\nhttps://issuetracker.google.com/issues/140786115\nということでDotLocalFinderというアプリを丸パクリインスパイアしてmDNSの名前解決をしてみる。\nhttps://github.com/Network-Revolution/DotLocalFinder\nDNSもmDNSもDNS-SDも全く知らないので聞きかじり見かじり注意。\nそもそもmDNSとは そもそもmDNSという規格がよくわからないので調べてみる。\nWikipedia様によると、RFC 6762で定義されたZeroconf技術とか言うものらしい。\nZeroconfはDHCPやらmDNSやらUPnPやらの技術を一纏めにした言い方なのかな？\n似た技術の中にRFC 6763で定義されたDNS-SDというものがあるがこっちはネットワーク内の機器を検索する技術みたい。\nmDNSをAndroidで名前解決するには まず「mDNS Android Developers」でGooglingするとNSDというAPIが出てくるがこれはDNS-SD関連のものでmDNSとは関係ないらしい。\nhttps://developer.android.com/training/connect-devices-wirelessly/nsd\n他にもJmDNSやらmdnsjavaなど使えそうなライブラリが出てくるがどれもDNS-SD関連のものでmDNSを名前解決できるものは出てこない。\n自分の解釈が間違ってるのかな？\nするとDotLocalFinderという唯一自分の目的にあってそうなアプリを見つけたのでコードを見てみると「xyz.gianlu.mdnsjava:mdnsjava」というライブラリを使用している。\nhttps://github.com/Network-Revolution/DotLocalFinder/blob/09b15a5bafe28175a86e7be7b2079dc5d26486fd/app/build.gradle.kts#L126\nmavenのsource.jarを見る限り前述したmdnsjavaのフォークのようだ。 https://repo1.maven.org/maven2/xyz/gianlu/mdnsjava/mdnsjava/2.2.1/\n実装 というわけで丸パクリインスパイアしてテキトーに実装してみる。\nメインスレッドでやると怒られるのでDispatchers.IOでやろーね☆\nちなみにTarget APIを30以上に上げると動作しません。\nhttps://github.com/Network-Revolution/DotLocalFinder/issues/2\n（29だとプレイストア弾かれるらしいけど）\n// 名前解決するホスト名 val resolveHost = \u0026#34;\u0026#34;  lifecycleScope.launch {  val multicastLock = (applicationContext.getSystemService(WIFI_SERVICE) as WifiManager).createMulticastLock(\u0026#34;ResolvemDNS\u0026#34;)  multicastLock.setReferenceCounted(true)  multicastLock.acquire()   val records = withContext(Dispatchers.IO) {  Lookup(resolveHost, Type.A, DClass.IN).lookupRecords()  // IPv6 (AAAAレコード)  // Lookup(resolveHost, Type.AAAA, DClass.IN).lookupRecords()  }   multicastLock.release()   if (records.isEmpty()) {  // 名前解決に失敗した場合  } else {  val resolvedIP = (records[0] as ARecord).address.hostAddress  // IPv6 (AAAAレコード)  // val resolvedIP = (records[0] as AAAARecord).address.hostAddress  } } MulticastLockはやらなくても良いっぽい。（ライブラリ側でよしなにしてくれてるのかな？）\n　*　*\n＊　＋　うそです\nn ∧＿∧　n\n＋　(ﾖ（* ´∀｀）E)\nY Y　＊\n別によしなにはしてくれていなかった。\n端末毎に動作が違うようで、MulticastLockしないと動作しない端末もあるようなので念の為しておいたほうがいい。\n","permalink":"https://carbonsushi.github.io/posts/android-resolve-mdns/","summary":"主要OSの中でAndroidだけがmDNSを名前解決できないらしい。 https://qiita.com/maccadoo/items/48ace84f8aca030a12f1 Chromium・AOSPにissueが提出されているがまったくもって","title":"AndroidでmDNSを名前解決する"},{"content":"マッシュルームの開発ドキュメントがいつの間にか消失していたのでメモ。\nInternet Archiveに残ってました。\nhttps://web.archive.org/web/20210303183042if_/simeji.me/blog/manuals/manuals_android/android_mushroom/make_mushroom/id=58\n要約（？） actionはcom.adamrocker.android.simeji.ACTION_INTERCEPT、\ncategoryはcom.adamrocker.android.simeji.REPLACE。\n（暗黙的インテントなのでandroid.intent.category.DEFAULTもcategoryに追加する）\nSimeji（呼び出し側）が送ってきた文字列はreplace_keyでgetStringExtraすると取得可能。\nSimeji（呼び出し側）に文字列を返す時は同じくresultにreplace_keyでputExtraすればOK。\n","permalink":"https://carbonsushi.github.io/posts/mushroom-develop/","summary":"マッシュルームの開発ドキュメントがいつの間にか消失していたのでメモ。 Internet Archiveに残ってました。 https://web.archive.org/web/20210303183042if_/simeji.me/blog/manuals/manuals_android/android_mushroom/make_mushroom/id=58 要約（？） actionはcom.ada","title":"マッシュルームの作りかた"},{"content":"タイトル通り。\n公式にもろにはっきり書かれてるけどメモ。\nhttps://developer.android.com/jetpack/androidx/releases/swiperefreshlayout\n解決策 \u0026lt;androidx.swiperefreshlayout.widget.SwipeRefreshLayout  android:layout_width=\u0026#34;match_parent\u0026#34;  android:layout_height=\u0026#34;match_parent\u0026#34;\u0026gt;   \u0026lt;androidx.viewpager2.widget.ViewPager2  android:layout_width=\u0026#34;match_parent\u0026#34;  android:layout_height=\u0026#34;match_parent\u0026#34; /\u0026gt; \u0026lt;/androidx.swiperefreshlayout.widget.SwipeRefreshLayout\u0026gt; みたいに使うとSwipeRefreshLayoutとViewPager2が競合してタッチ操作がおかしくなる。\nなので修正されてる1.2.0-alpha01を使えばサクッと解決。\n requestDisallowInterceptTouchEvent(boolean) が、他の ViewGroup と同様に、リクエストを受け入れるようになりました。この新しい動作は setLegacyRequestDisallowInterceptTouchEventEnabled で無効にできますが、無効にしないことを強くおすすめします。（I968da、b/141855018）\n implementation \u0026#39;androidx.swiperefreshlayout:swiperefreshlayout:1.2.0-alpha01\u0026#39; 1.1.0-alpha03で直されてるのはViewPager2が親の場合の話なのかな？\nテストしていないので不明。\n requestDisallowInterceptTouchEvent(boolean) が常に親にまで伝播するようになりました。この新しい動作は setLegacyRequestDisallowInterceptTouchEventEnabled で無効にできますが、無効にしないことを強くおすすめします（aosp/1108540）\n それにしても検索でViewPagerとViewPager2の情報がまあよく混ざる。\nもうちょっと名前変えてくれ。\n","permalink":"https://carbonsushi.github.io/posts/swiperefreshlayout-viewpager2/","summary":"タイトル通り。 公式にもろにはっきり書かれてるけどメモ。 https://developer.android.com/jetpack/androidx/releases/swiperefreshlayout 解決策 \u0026lt;androidx.swiperefreshlayout.widget.SwipeRefreshLayout android:layout_width=\u0026#34;match_parent\u0026#34; android:layout_height=\u0026#34;match_parent\u0026#34;\u0026gt; \u0026lt;androidx.viewpager2.widget.ViewPager2 android:layout_width=\u0026#34;match_parent\u0026#34; android:layout_height=\u0026#34;match_parent\u0026#34; /\u0026gt; \u0026lt;/androidx.swiperefreshlayout.widget.SwipeRefreshLayout\u0026gt; みたいに使うとSwipeRefreshLayoutとViewP","title":"SwipeRefreshLayoutの子にViewPager2を使うなら1.2.0-alpha01を使え"},{"content":"いつの間にか実機でIntent（正確にはIntent.ACTION_VIEWの暗黙的インテント）がまともに機能しなくなってしまった。\nMIUIの妙なカスタムが悪いのか、はたまたブラウザーが悪いのかまったくわからない。\nアプデで修正されると思っていたが一向に修正されない。\nなのでブラウザーとして振る舞い、Intentを適切なアプリに振り分けるアプリを作った。\nhttps://github.com/carbonsushi/browser-intent-divider\n使い方 設定 → アプリ → デフォルトのアプリ → ブラウザアプリ → 「Browser intent divider」を選択するだけ。\n誤作動があるのでその時は設定の「Exclude package list」・「Priority package list」を弄ればOK。\n「Exclude package list」よりも「Priority package list」が優先されます。\n","permalink":"https://carbonsushi.github.io/posts/browser-intent-divider/","summary":"いつの間にか実機でIntent（正確にはIntent.ACTION_VIEWの暗黙的インテント）がまともに機能しなくなってしまった。 MIUI","title":"Browser intent dividerを作った"},{"content":"日本のスマホは何故かシャッター音が鳴る。\n法律で決まっているのかと思えばそうではなくただの自主規制。\n（一応韓国にも同じような規制はあるらしい）\nXiaomiのような海外製のスマホにも付いている。 はっきり言ってうるさいし地域設定を変えれば消せるので盗撮対策にも全くなってない。\nこの自主規制の存在意義が分からない…\nしかし地域設定を変えるとなにか弊害がありそうだ。\nというわけでMIUIのカメラアプリのみ地域設定をアメリカに変更するXposedモジュールを作った。\nhttps://github.com/carbonsushi/mi-shutter\n使い方 インストールしてマネージャーで有効化するだけ。\n設定も特になし。\n","permalink":"https://carbonsushi.github.io/posts/mi-shutter/","summary":"日本のスマホは何故かシャッター音が鳴る。 法律で決まっているのかと思えばそうではなくただの自主規制。 （一応韓国にも同じような規制はあるらしい）","title":"Mi shutterを作った"},{"content":"ChMateという掲示板書き込みアプリには「外部アプリで書き込む」というオプションがある。\n恐らく対応しているのは2chGearというアプリのみなのだが、5chが強制SSL化してから使えなくなっているようだ。\nhttps://play.google.com/store/apps/details?id=jp.emprise.android.x2chGear\n作者が\u0026lt;intent-filter\u0026gt;を変更してくれればそれで済むのだが、いっこうに修正される様子がない。\nなので間に挟まりIntentを受け渡すプロキシアプリを作ってみた。\nhttps://github.com/carbonsushi/2chgear-chmate-proxy\n使い方 2chGearと2chGear ChMate proxyをインストール後、ChMateの「外部アプリで書き込む」オプションを有効化する。\nあとはChMateの書き込みボタンを押すだけ。\nちなみにスレ立ては2chGear側が対応していないっぽいので不可能です。\n","permalink":"https://carbonsushi.github.io/posts/2chgear-chmate-proxy/","summary":"ChMateという掲示板書き込みアプリには「外部アプリで書き込む」というオプションがある。 恐らく対応しているのは2chGearというアプリの","title":"2chGear ChMate proxyを作った"},{"content":"IPTVというそのまんまの名前のアプリでIPTVを視聴していたのだが、\nいつの間にか非公開になっていて再インストール不可に。\nhttps://web.archive.org/web/20211108010120if_/play.google.com/store/apps/details?id=ru.iptvremote.android.iptv\n同じ作者が公開しているIPTV CoreとIPTV Core Launcherというアプリを使えばほぼ同じ機能・無料で使えるようだ。\nhttps://play.google.com/store/apps/details?id=ru.iptvremote.android.iptv.core\nhttps://play.google.com/store/apps/details?id=ru.iptvremote.android.iptv.core.launcher\nしかしIPTV Core Launcherが毎回プレイリストのURLを入力しなければならなく不便なので自分でLauncherを作ってみた。\nおまけとしてmDNSの名前解決機能付き。\nhttps://github.com/carbonsushi/iptv-core-launcher\n使い方 IPTV CoreとIPTV Core launcherをインストール後「IPTV Core launcher: Settings」を開いてプレイリストのURLを設定する。\n設定したら「IPTV Core launcher」を開くだけ。\nオチ 実はよくよく設定見てみたらPIP機能が付いていなかったり一部の設定が消えていたりとただの劣化版だった。\n有料版は公開されたままだけど買うほどじゃない…\nhttps://play.google.com/store/apps/details?id=ru.iptvremote.android.iptv.pro\n","permalink":"https://carbonsushi.github.io/posts/iptv-core-launcher/","summary":"IPTVというそのまんまの名前のアプリでIPTVを視聴していたのだが、 いつの間にか非公開になっていて再インストール不可に。 https://web.archive.org/web/20211108010120if_/play.google.com/store/apps/details?id=ru.iptvremote.android.iptv 同じ作者が公開し","title":"IPTV Core launcherを作った"},{"content":"HugoとGitHub Pagesで作ってみた。\n","permalink":"https://carbonsushi.github.io/posts/hello-blog/","summary":"HugoとGitHub Pagesで作ってみた。","title":"Hello, Blog!"}]